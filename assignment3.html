<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Assignment 2 &mdash; Formulas and Vehicles  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Assignment 1" href="assignment1.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Formulas and Vehicles
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Class Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="concepts.html">Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation and Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="the_robot.html">The Robot</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="resources.html">ROS Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="assignment1.html">Assignment 1</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Assignment 2</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#range-sensor-in-simulation">Range Sensor in Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#taking-it-further">Taking it Further</a></li>
<li class="toctree-l2"><a class="reference internal" href="#some-final-remarks">Some Final Remarks</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Formulas and Vehicles</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Assignment 2</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/HippoCampusRobotics/fav_docs/blob/master/assignment3.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="assignment-2">
<h1>Assignment 2<a class="headerlink" href="#assignment-2" title="Permalink to this headline"></a></h1>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Please update the <code class="code docutils literal notranslate"><span class="pre">bluerov_sim</span></code> package.</p>
<p>We have prepared a <strong>launch file</strong> for you to start with: <code class="file docutils literal notranslate"><span class="pre">assignment_2.launch</span></code></p>
</div>
<p>In this assignment, you will implement an algorithm for autonomous navigation within a confined environment. This will include a localization method and a path tracking controller.</p>
<p>Again, keep in mind that the best controller isn’t any good if your position data is rubbish. Set your priorities accordingly.</p>
<div class="section" id="range-sensor-in-simulation">
<h2>Range Sensor in Simulation<a class="headerlink" href="#range-sensor-in-simulation" title="Permalink to this headline"></a></h2>
<p>We are not actually using simulated camera images and running the AprilTag algorithm in simulation. Rather, we have written a Gazebo Plugin that simulates the range measurements to the four given anchors. This has the benefit of reducing the computational burden.</p>
<p>This range sensor plugin has a few parameters we encourage you to play with. In the <code class="code docutils literal notranslate"><span class="pre">bluerov_sim</span></code> package you can find the *.sdf file defining our BlueROV2 model for Gazebo: <code class="code docutils literal notranslate"><span class="pre">models/uuv_bluerov2_heavy/uuv_bluerov2_heavy.sdf</span></code></p>
<p>The range sensor plugin parameters can be found here:</p>
<div class="highlight-XML notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;plugin</span> <span class="na">name=</span><span class="s">&quot;range_sensor_plugin&quot;</span> <span class="na">filename=</span><span class="s">&quot;libgazebo_range_sensor_plugin.so&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;robotNamespace</span> <span class="nt">/&gt;</span>
   <span class="nt">&lt;pubRate&gt;</span>7.0<span class="nt">&lt;/pubRate&gt;</span>
   <span class="nt">&lt;rangeNoiseStd&gt;</span>0.01<span class="nt">&lt;/rangeNoiseStd&gt;</span>
   <span class="nt">&lt;fovCamera&gt;</span>100<span class="nt">&lt;/fovCamera&gt;</span>
   <span class="nt">&lt;viewingAngle&gt;</span>140<span class="nt">&lt;/viewingAngle&gt;</span>
   <span class="nt">&lt;dropProb&gt;</span>0.02<span class="nt">&lt;/dropProb&gt;</span>
   <span class="nt">&lt;maxDetectionDist&gt;</span>5.0<span class="nt">&lt;/maxDetectionDist&gt;</span>
   <span class="nt">&lt;distDropProbExponent&gt;</span>2.0<span class="nt">&lt;/distDropProbExponent&gt;</span>
<span class="nt">&lt;/plugin&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>pubRate</strong>: The publishing rate for the range measurements.</p></li>
<li><p><strong>rangeNoiseStd</strong>: We add white, Gaussian noise on the distance measurements, this sets the standard deviation.</p></li>
<li><p><strong>fovCamera</strong>: The camera’s field of view (fov) angle.</p></li>
<li><p><strong>viewingAngle</strong>: The viewing angle at which a tag is still detectable.</p></li>
<li><p><strong>dropProb</strong>: The probability a single distance measurement is dropped.</p></li>
<li><p><strong>maxDetectionDist</strong> and <strong>distDropProbExponent</strong>: We compute an additional probability that a tag measurement will be dropped which increases with increasing distance to the tag. This is independent of the general <strong>dropProb</strong>.</p></li>
</ul>
<p>We compute this probability according to the following equation, where the <strong>distDropProbExponent</strong> is n:</p>
<div class="math notranslate nohighlight">
\[p_{\text{drop}}(\text{dist}) = \frac{1}{\text{maxDist}^{n}} \cdot \text{dist}^{n}\]</div>
<p>You can use these parameters to test your algorithm in different situations and prepare for reality with varying degrees of pessimism.</p>
<p>The range sensor’s position for the simulation is defined in the <code class="code docutils literal notranslate"><span class="pre">uuv_bluerov2_heavy.sdf</span></code> file as well (relative to the body frame <code class="code docutils literal notranslate"><span class="pre">base_link</span></code>):</p>
<div class="highlight-XML notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">&quot;range_sensor_link&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;pose&gt;</span>0.2 0 0.1 0 0 0<span class="nt">&lt;/pose&gt;</span>
   ...
<span class="nt">&lt;/link&gt;</span>
</pre></div>
</div>
<p>This hasn’t been measured precisely (one of us looked at the BlueROV2 and squinted their eyes…) and you will probably want to make sure this position is adaptable in your code, if you define (and use) it somewhere.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>When you implement your localization and problems arise, you might want to turn off the noise to test whether your algorithm is working at all.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For the experiment, we are reusing four AprilTags that are already used on the floor on the other side of the tank. Therefore, if the BlueROV gets completely lost, you might get false measurements. However, if you keep the four tags on the wall within the camera’s field of view, this shouldn’t be a problem.</p>
</div>
</div>
<div class="section" id="taking-it-further">
<h2>Taking it Further<a class="headerlink" href="#taking-it-further" title="Permalink to this headline"></a></h2>
<p>In the following, we collected a few hints for you. They are supposed to help you dive deeper into the simulation (if you want to).</p>
<p>In general, we encourage you to use our <code class="code docutils literal notranslate"><span class="pre">keyboard_control</span></code> node for convenient testing of your localization.
Feel free to use the rest of the Gazebo ground truth data, for example the position, to evaluate your algorithm.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>The <code class="code docutils literal notranslate"><span class="pre">tf.transformations</span></code> library helps you deal with quaternions. Check the <a class="reference external" href="http://docs.ros.org/en/melodic/api/tf/html/python/transformations.html">API</a> .</p>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>You can access IMU data in the topic <code class="code docutils literal notranslate"><span class="pre">bluerov/mavros/imu/data</span></code>, this has already been filtered by the FCU’s on-board estimator.</p>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>As you have noticed in the first experiment, the real BlueROV2 behaves differently to the simulated one. The fact that we’ve never done a proper parameter identification doesn’t help. Priorities… the simulation works perfectly fine for testing and evaluating your algorithms.</p>
<p>However, if you want to adjust how the BlueROV2 is behaving in simulation, you can find some parameters in the sdf file, too. You’ll be mostly interested in our <code class="code docutils literal notranslate"><span class="pre">uuv_plugin</span></code>, where you can change the linear and angular damping, and the buoyancy:</p>
<div class="highlight-XML notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;plugin</span> <span class="na">name=</span><span class="s">&quot;uuv_plugin&quot;</span> <span class="na">filename=</span><span class="s">&quot;libgazebo_uuv_plugin.so&quot;</span><span class="nt">&gt;</span>
      ...
      <span class="nt">&lt;dampingLinear&gt;</span>7 7 7<span class="nt">&lt;/dampingLinear&gt;</span>
      <span class="nt">&lt;dampingAngular&gt;</span>0.3 0.3 0.3<span class="nt">&lt;/dampingAngular&gt;</span>
      ...
      <span class="nt">&lt;buoyancy&gt;</span>
          <span class="nt">&lt;link_name&gt;</span>base_link<span class="nt">&lt;/link_name&gt;</span>
          <span class="nt">&lt;origin&gt;</span>0 0 0.01<span class="nt">&lt;/origin&gt;</span>
          <span class="nt">&lt;compensation&gt;</span>1.001<span class="nt">&lt;/compensation&gt;</span>
          <span class="nt">&lt;height_scale_limit&gt;</span>0.05<span class="nt">&lt;/height_scale_limit&gt;</span>
      <span class="nt">&lt;/buoyancy&gt;</span>
  <span class="nt">&lt;/plugin&gt;</span>
</pre></div>
</div>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>Similarly to the BlueROV2 sdf file, there’s an sdf file for the tank, where the AprilTag models are included. If you’re curious about trying other tag positions (or orientations), you can do this here:</p>
<div class="highlight-XML notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;include&gt;</span>
   <span class="nt">&lt;name&gt;</span>tag_1<span class="nt">&lt;/name&gt;</span>
   <span class="nt">&lt;uri&gt;</span>model://tag36_11_00000<span class="nt">&lt;/uri&gt;</span>
   <span class="nt">&lt;pose&gt;</span>0.5 3.35 -0.5 1.57079632679 -0.0 0.0<span class="nt">&lt;/pose&gt;</span>
<span class="nt">&lt;/include&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="some-final-remarks">
<h2>Some Final Remarks<a class="headerlink" href="#some-final-remarks" title="Permalink to this headline"></a></h2>
<p>In this assignment you will do different things, including implementing a self-localization algorithm for the BlueROV2 and a controller to autonomously navigate inside the tank. Think about your code structure and package structure to ensure (re-)usability.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Please do not change code (apart from playing with parameters purely for your simulation, of course) in our repositories, namely <code class="code docutils literal notranslate"><span class="pre">bluerov_sim</span></code>. Instead, create your own packages.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="assignment1.html" class="btn btn-neutral float-left" title="Assignment 1" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Thies Lennart Alff, Nathalie Bauschmann, Daniel Dücker.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>