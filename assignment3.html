

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Assignment 3 &mdash; Formulas and Vehicles  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Final Project" href="final_project.html" />
    <link rel="prev" title="Assignment 2" href="assignment2.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> Formulas and Vehicles
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation and Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="concepts.html">Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="the_robot.html">The Robot</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="resources.html">ROS Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="assignment2.html">Assignment 2</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Assignment 3</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#get-the-code">Get the Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="#range-sensor-in-simulation">Range Sensor in Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#taking-it-further">Taking it Further</a></li>
<li class="toctree-l2"><a class="reference internal" href="#some-final-remarks">Some Final Remarks</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="final_project.html">Final Project</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Formulas and Vehicles</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Assignment 3</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/HippoCampusRobotics/fav_docs/blob/master/assignment3.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="assignment-3">
<h1>Assignment 3<a class="headerlink" href="#assignment-3" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Remember to regularly update your local repositories as described in the previous section. In case we make major changes, we’ll send a slack reminder to update.</p>
</div>
<div class="section" id="get-the-code">
<h2>Get the Code<a class="headerlink" href="#get-the-code" title="Permalink to this headline">¶</a></h2>
<p>You will need to update your <code class="code docutils literal notranslate"><span class="pre">bluerov_sim</span></code> package, for example by:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>roscd bluerov_sim <span class="o">&amp;&amp;</span> git pull
</pre></div>
</div>
<p>We have prepared a <code class="code docutils literal notranslate"><span class="pre">range_sensor</span></code> package that will publish the range measurements in a topic <code class="code docutils literal notranslate"><span class="pre">/ranges</span></code>:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/FormulasAndVehicles/range_sensor.git ~/fav/catkin_ws/src/range_sensor
</pre></div>
</div>
<p>To install missing dependencies:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> ~/fav/catkin_ws <span class="o">&amp;&amp;</span> rosdep install --from-paths src --ignore-src -r -y
</pre></div>
</div>
<p>Don’t forget to rebuild your catkin workspace after downloading these packages.</p>
</div>
<div class="section" id="range-sensor-in-simulation">
<h2>Range Sensor in Simulation<a class="headerlink" href="#range-sensor-in-simulation" title="Permalink to this headline">¶</a></h2>
<p>We are not actually using simulated camera images and running the AprilTag algorithm in simulation. Rather, we have written a Gazebo Plugin that simulates the range measurements to the four given anchors. This has the benefit of reducing the computational burden.</p>
<p>The range sensor plugin has a few parameters we encourage you to play with. In the <code class="code docutils literal notranslate"><span class="pre">bluerov_sim</span></code> package you can find the *.sdf file defining our BlueROV2 model for Gazebo: <code class="code docutils literal notranslate"><span class="pre">models/uuv_bluerov2_heavy/uuv_bluerov2_heavy.sdf</span></code></p>
<p>The range sensor plugin parameters can be found here:</p>
<div class="highlight-XML notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;plugin</span> <span class="na">name=</span><span class="s">&quot;range_sensor_plugin&quot;</span> <span class="na">filename=</span><span class="s">&quot;libgazebo_range_sensor_plugin.so&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;robotNamespace</span> <span class="nt">/&gt;</span>
   <span class="nt">&lt;pubRate&gt;</span>7.0<span class="nt">&lt;/pubRate&gt;</span>
   <span class="nt">&lt;rangeNoiseStd&gt;</span>0.1<span class="nt">&lt;/rangeNoiseStd&gt;</span>
   <span class="nt">&lt;fovCamera&gt;</span>100<span class="nt">&lt;/fovCamera&gt;</span>
   <span class="nt">&lt;viewingAngle&gt;</span>140<span class="nt">&lt;/viewingAngle&gt;</span>
   <span class="nt">&lt;dropProb&gt;</span>0.05<span class="nt">&lt;/dropProb&gt;</span>
   <span class="nt">&lt;maxDetectionDist&gt;</span>4.0<span class="nt">&lt;/maxDetectionDist&gt;</span>
   <span class="nt">&lt;distDropProbExponent&gt;</span>2.0<span class="nt">&lt;/distDropProbExponent&gt;</span>
<span class="nt">&lt;/plugin&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>pubRate</strong>: The publishing rate for the range measurements.</p></li>
<li><p><strong>rangeNoiseStd</strong>: We add white, Gaussian noise on the distance measurements, this sets the standard deviation.</p></li>
<li><p><strong>fovCamera</strong>: The camera’s field of view (fov) angle.</p></li>
<li><p><strong>viewingAngle</strong>: The viewing angle at which a tag is still detectable.</p></li>
<li><p><strong>dropProb</strong>: The probability a single distance measurement is dropped.</p></li>
<li><p><strong>maxDetectionDist</strong> and <strong>distDropProbExponent</strong>: We compute an additional probability that a tag measurement will be dropped which increases with increasing distance to the tag. This is independent of the general <strong>dropProb</strong>.</p></li>
</ul>
<p>We compute this probability according to the following equation, where the <strong>distDropProbExponent</strong> is n:</p>
<div class="math notranslate nohighlight">
\[p_{\text{drop}}(\text{dist}) = \frac{1}{\text{maxDist}^{n}} \cdot \text{dist}^{n}\]</div>
<p>You can use these parameters to test your algorithm in different situations and prepare for reality with varying degrees of pessimism.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>When you implement your localization and problems arise, you might want to turn off the noise to test whether your algorithm is working at all.</p>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>The range sensor’s position for the simulation is defined in the <code class="code docutils literal notranslate"><span class="pre">uuv_bluerov2_heavy.sdf</span></code> file as well (relative to the body frame <code class="code docutils literal notranslate"><span class="pre">base_link</span></code>):</p>
<div class="highlight-XML notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">&quot;range_sensor_link&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;pose&gt;</span>0.2 0 0.1 0 0 0<span class="nt">&lt;/pose&gt;</span>
   ...
<span class="nt">&lt;/link&gt;</span>
</pre></div>
</div>
<p>This hasn’t been measured precisely (one of us looked at the BlueROV2 and squinted their eyes…) and you will probably want to make sure this position is adaptable in your code, if you define it somewhere.</p>
</div>
</div>
<div class="section" id="taking-it-further">
<h2>Taking it Further<a class="headerlink" href="#taking-it-further" title="Permalink to this headline">¶</a></h2>
<p>In the following, we collected a few hints for you. They are supposed to help you dive deeper into the simulation.</p>
<p>In general, we encourage you to use our <code class="code docutils literal notranslate"><span class="pre">keyboard_control</span></code> node for convenient testing.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Feel free to use the rest of the Gazebo ground truth data, for example the position, to evaluate your localization algorithm. Keep in mind that velocities are given in the world frame “map”. Our docs section <a class="reference internal" href="resources.html#coordinate-transformations"><span class="std std-ref">Coordinate Transformations</span></a> includes some pointers for where to look.</p>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>The <code class="code docutils literal notranslate"><span class="pre">tf.transformations</span></code> library helps you deal with quaternions. Check the <a class="reference external" href="http://docs.ros.org/en/melodic/api/tf/html/python/transformations.html">API</a> .</p>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>You can access IMU data in the topic <code class="code docutils literal notranslate"><span class="pre">mavros/imu/data</span></code>, this has already been filtered by PX4’s own estimator.</p>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>As you have noticed in the first experiment, the real BlueROV2 behaves differently to the simulated one. The fact that we’ve never done a proper parameter identification doesn’t help. Priorities… the simulation works perfectly fine for testing and evaluating your algorithms.</p>
<p>However, if you want to adjust how the BlueROV2 is behaving in simulation, you can find some parameters in the sdf file, too. You’ll be mostly interested in our <code class="code docutils literal notranslate"><span class="pre">uuv_plugin</span></code>, where you can change the linear and angular damping, and the buoyancy:</p>
<div class="highlight-XML notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;plugin</span> <span class="na">name=</span><span class="s">&quot;uuv_plugin&quot;</span> <span class="na">filename=</span><span class="s">&quot;libgazebo_uuv_plugin.so&quot;</span><span class="nt">&gt;</span>
      ...
      <span class="nt">&lt;dampingLinear&gt;</span>7 7 7<span class="nt">&lt;/dampingLinear&gt;</span>
      <span class="nt">&lt;dampingAngular&gt;</span>0.3 0.3 0.3<span class="nt">&lt;/dampingAngular&gt;</span>
      ...
      <span class="nt">&lt;buoyancy&gt;</span>
          <span class="nt">&lt;link_name&gt;</span>base_link<span class="nt">&lt;/link_name&gt;</span>
          <span class="nt">&lt;origin&gt;</span>0 0 0.01<span class="nt">&lt;/origin&gt;</span>
          <span class="nt">&lt;compensation&gt;</span>1.001<span class="nt">&lt;/compensation&gt;</span>
          <span class="nt">&lt;height_scale_limit&gt;</span>0.05<span class="nt">&lt;/height_scale_limit&gt;</span>
      <span class="nt">&lt;/buoyancy&gt;</span>
  <span class="nt">&lt;/plugin&gt;</span>
</pre></div>
</div>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>Similarly to the BlueROV2 sdf file, there’s an sdf file for the tank, where the AprilTag models are included. If you’re curious about trying other tag positions (or orientations), you can do this here:</p>
<div class="highlight-XML notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;include&gt;</span>
   <span class="nt">&lt;name&gt;</span>tag_1<span class="nt">&lt;/name&gt;</span>
   <span class="nt">&lt;uri&gt;</span>model://tag36_11_00000<span class="nt">&lt;/uri&gt;</span>
   <span class="nt">&lt;pose&gt;</span>0.5 3.35 -0.5 1.57079632679 -0.0 0.0<span class="nt">&lt;/pose&gt;</span>
<span class="nt">&lt;/include&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="some-final-remarks">
<h2>Some Final Remarks<a class="headerlink" href="#some-final-remarks" title="Permalink to this headline">¶</a></h2>
<p>In this assignment you will do different things, including implementing a self-localization algorithm for the BlueROV2 and a controller to autonomously navigate inside the tank. Think about your code structure and package structure to ensure (re-)usability.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Please do not change code (apart from playing with parameters purely for your simulation, of course) in our repositories, namely <code class="code docutils literal notranslate"><span class="pre">bluerov_sim</span></code> and <code class="code docutils literal notranslate"><span class="pre">range_sensor</span></code>. There are some adjustments missing for the experiment that we are working hard on, so you will have to be able to pull our uploaded code from Github.
Instead, create your own packages.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="final_project.html" class="btn btn-neutral float-right" title="Final Project" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="assignment2.html" class="btn btn-neutral float-left" title="Assignment 2" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2021, Thies Lennart Alff, Nathalie Bauschmann, Daniel Dücker

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>